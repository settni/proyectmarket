<?xml version="1.0" encoding="utf-8"?>
<androidx.coordinatorlayout.widget.CoordinatorLayout xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    xmlns:tools="http://schemas.android.com/tools"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:background="?attr/colorSurface"
    tools:context=".DetalleProductoActivity">

    <!-- AppBarLayout con Toolbar para el botón de retroceso -->
    <com.google.android.material.appbar.AppBarLayout
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:theme="@style/ThemeOverlay.AppCompat.Dark.ActionBar">

        <androidx.appcompat.widget.Toolbar
            android:id="@+id/toolbar_detalle"
            android:layout_width="match_parent"
            android:layout_height="?attr/actionBarSize"
            android:background="?attr/colorPrimary"
            app:title="Detalles del Producto"
            app:navigationIcon="?attr/homeAsUpIndicator"
            app:popupTheme="@style/ThemeOverlay.AppCompat.Light" />

    </com.google.android.material.appbar.AppBarLayout>

    <!-- Contenido desplazable del detalle del producto -->
    <androidx.core.widget.NestedScrollView
        android:layout_width="match_parent"
        android:layout_height="match_parent"
        android:clipToPadding="false"
        android:paddingBottom="90dp"
        app:layout_behavior="@string/appbar_scrolling_view_behavior">

        <androidx.constraintlayout.widget.ConstraintLayout
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:paddingBottom="16dp">

            <!-- ****************************************************** -->
            <!-- CARRUSEL DE IMÁGENES (ViewPager2 y TabLayout) -->
            <!-- ****************************************************** -->

            <!-- ViewPager2 para el carrusel de múltiples imágenes. Altura fija de 300dp. -->
            <androidx.viewpager2.widget.ViewPager2
                android:id="@+id/view_pager_galeria"
                android:layout_width="0dp"
                android:layout_height="300dp"
                app:layout_constraintTop_toTopOf="parent"
                app:layout_constraintStart_toStartOf="parent"
                app:layout_constraintEnd_toEndOf="parent" />

            <!-- Indicador de página (los puntos) asociado al ViewPager2. -->
            <com.google.android.material.tabs.TabLayout
                android:id="@+id/tab_layout_indicador"
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:layout_marginBottom="8dp"
                app:tabBackground="@drawable/tab_selector"
                app:tabIndicatorHeight="0dp"
                app:layout_constraintBottom_toTopOf="@+id/card_info"
                app:layout_constraintEnd_toEndOf="parent"
                app:layout_constraintStart_toStartOf="parent"
                app:layout_constraintTop_toBottomOf="@+id/view_pager_galeria"
                app:layout_constraintVertical_bias="0.9" />

            <!-- ****************************************************** -->
            <!-- FIN DEL CARRUSEL DE IMÁGENES -->
            <!-- ****************************************************** -->

            <!-- Contenedor principal de la información -->
            <androidx.cardview.widget.CardView
                android:id="@+id/card_info"
                android:layout_width="0dp"
                android:layout_height="wrap_content"
                android:layout_marginStart="16dp"
                android:layout_marginEnd="16dp"
                android:layout_marginTop="-40dp"
                app:cardBackgroundColor="?attr/colorSurface"
                app:cardCornerRadius="16dp"
                app:cardElevation="8dp"
                app:layout_constraintStart_toStartOf="parent"
                app:layout_constraintEnd_toEndOf="parent"
                app:layout_constraintTop_toBottomOf="@+id/view_pager_galeria">

                <androidx.constraintlayout.widget.ConstraintLayout
                    android:layout_width="match_parent"
                    android:layout_height="match_parent"
                    android:padding="20dp">

                    <!-- Título del Producto -->
                    <TextView
                        android:id="@+id/tv_detalle_titulo"
                        android:layout_width="0dp"
                        android:layout_height="wrap_content"
                        tools:text="Producto en Venta: Ejemplo de Alta Calidad"
                        android:text="Cargando..."
                        android:textSize="24sp"
                        android:textStyle="bold"
                        android:textColor="?attr/colorOnSurface"
                        app:layout_constraintEnd_toEndOf="parent"
                        app:layout_constraintStart_toStartOf="parent"
                        app:layout_constraintTop_toTopOf="parent" />

                    <!-- Precio del Producto -->
                    <TextView
                        android:id="@+id/tv_detalle_precio"
                        android:layout_width="wrap_content"
                        android:layout_height="wrap_content"
                        android:layout_marginTop="8dp"
                        tools:text="$ 99.990 CLP"
                        android:text="Precio: -"
                        android:textSize="28sp"
                        android:textStyle="bold"
                        android:textColor="?attr/colorAccent"
                        app:layout_constraintStart_toStartOf="parent"
                        app:layout_constraintTop_toBottomOf="@+id/tv_detalle_titulo" />

                    <!-- Separador 1 -->
                    <View
                        android:id="@+id/divider1"
                        android:layout_width="0dp"
                        android:layout_height="1dp"
                        android:layout_marginTop="16dp"
                        android:background="@android:color/darker_gray"
                        app:layout_constraintEnd_toEndOf="parent"
                        app:layout_constraintStart_toStartOf="parent"
                        app:layout_constraintTop_toBottomOf="@+id/tv_detalle_precio" />

                    <!-- *************** SECCIÓN DE ESPECIFICACIONES *************** -->
                    <TextView
                        android:id="@+id/tv_etiqueta_especificaciones"
                        android:layout_width="wrap_content"
                        android:layout_height="wrap_content"
                        android:layout_marginTop="16dp"
                        android:text="Especificaciones"
                        android:textSize="18sp"
                        android:textStyle="bold"
                        android:textColor="?attr/colorOnSurface"
                        app:layout_constraintStart_toStartOf="parent"
                        app:layout_constraintTop_toBottomOf="@+id/divider1" />

                    <!-- Marca del Producto -->
                    <TextView
                        android:id="@+id/tv_detalle_marca"
                        android:layout_width="0dp"
                        android:layout_height="wrap_content"
                        android:layout_marginTop="8dp"
                        android:text="Marca: Cargando..."
                        android:textColor="?attr/colorOnSurface"
                        app:layout_constraintEnd_toEndOf="parent"
                        app:layout_constraintStart_toStartOf="parent"
                        app:layout_constraintTop_toBottomOf="@+id/tv_etiqueta_especificaciones" />

                    <!-- Condición del Producto -->
                    <TextView
                        android:id="@+id/tv_detalle_condicion"
                        android:layout_width="0dp"
                        android:layout_height="wrap_content"
                        android:layout_marginTop="4dp"
                        android:text="Condición: Cargando..."
                        android:textColor="?attr/colorOnSurface"
                        app:layout_constraintEnd_toEndOf="parent"
                        app:layout_constraintStart_toStartOf="parent"
                        app:layout_constraintTop_toBottomOf="@+id/tv_detalle_marca" />

                    <!-- Categoría del Producto -->
                    <TextView
                        android:id="@+id/tv_detalle_categoria"
                        android:layout_width="0dp"
                        android:layout_height="wrap_content"
                        android:layout_marginTop="4dp"
                        android:text="Categoría: Cargando..."
                        android:textColor="?attr/colorOnSurface"
                        app:layout_constraintEnd_toEndOf="parent"
                        app:layout_constraintStart_toStartOf="parent"
                        app:layout_constraintTop_toBottomOf="@+id/tv_detalle_condicion" />

                    <!-- Dirección de Retiro -->
                    <TextView
                        android:id="@+id/tv_detalle_direccion"
                        android:layout_width="0dp"
                        android:layout_height="wrap_content"
                        android:layout_marginTop="4dp"
                        android:text="Retiro en: Cargando..."
                        android:textColor="?attr/colorOnSurface"
                        app:layout_constraintEnd_toEndOf="parent"
                        app:layout_constraintStart_toStartOf="parent"
                        app:layout_constraintTop_toBottomOf="@+id/tv_detalle_categoria" />


                    <!-- Separador 2 -->
                    <View
                        android:id="@+id/divider2"
                        android:layout_width="0dp"
                        android:layout_height="1dp"
                        android:layout_marginTop="16dp"
                        android:background="@android:color/darker_gray"
                        app:layout_constraintEnd_toEndOf="parent"
                        app:layout_constraintStart_toStartOf="parent"
                        app:layout_constraintTop_toBottomOf="@+id/tv_detalle_direccion" />

                    <!-- *************** SECCIÓN DE DESCRIPCIÓN *************** -->
                    <TextView
                        android:id="@+id/tv_etiqueta_descripcion"
                        android:layout_width="wrap_content"
                        android:layout_height="wrap_content"
                        android:layout_marginTop="16dp"
                        android:text="Descripción del Producto"
                        android:textSize="18sp"
                        android:textStyle="bold"
                        android:textColor="?attr/colorOnSurface"
                        app:layout_constraintStart_toStartOf="parent"
                        app:layout_constraintTop_toBottomOf="@+id/divider2" />

                    <!-- Descripción del Producto -->
                    <TextView
                        android:id="@+id/tv_detalle_descripcion"
                        android:layout_width="0dp"
                        android:layout_height="wrap_content"
                        android:layout_marginTop="8dp"
                        android:text="Cargando descripción desde Firebase..."
                        android:textColor="?attr/colorOnSurface"
                        android:textSize="16sp"
                        app:layout_constraintEnd_toEndOf="parent"
                        app:layout_constraintStart_toStartOf="parent"
                        app:layout_constraintTop_toBottomOf="@+id/tv_etiqueta_descripcion"
                        tools:text="Esta es la descripción detallada del producto que se carga directamente desde la base de datos de Firebase. Ya no se usa 'lorem ipsum' en el layout, solo en la vista previa del diseñador."/>

                    <!-- Separador 3 -->
                    <View
                        android:id="@+id/divider3"
                        android:layout_width="0dp"
                        android:layout_height="1dp"
                        android:layout_marginTop="16dp"
                        android:background="@android:color/darker_gray"
                        app:layout_constraintEnd_toEndOf="parent"
                        app:layout_constraintStart_toStartOf="parent"
                        app:layout_constraintTop_toBottomOf="@+id/tv_detalle_descripcion" />

                    <!-- *************** SECCIÓN DE VENDEDOR *************** -->
                    <TextView
                        android:id="@+id/tv_etiqueta_contacto"
                        android:layout_width="wrap_content"
                        android:layout_height="wrap_content"
                        android:layout_marginTop="16dp"
                        android:text="Información de Contacto"
                        android:textSize="18sp"
                        android:textStyle="bold"
                        android:textColor="?attr/colorOnSurface"
                        app:layout_constraintStart_toStartOf="parent"
                        app:layout_constraintTop_toBottomOf="@+id/divider3" />

                    <!-- Nombre del Vendedor -->
                    <TextView
                        android:id="@+id/tv_detalle_vendedor"
                        android:layout_width="0dp"
                        android:layout_height="wrap_content"
                        android:layout_marginTop="8dp"
                        android:text="Nombre: Cargando..."
                        android:textColor="?attr/colorOnSurface"
                        app:layout_constraintStart_toStartOf="parent"
                        app:layout_constraintTop_toBottomOf="@+id/tv_etiqueta_contacto" />

                    <!-- Email del Vendedor -->
                    <TextView
                        android:id="@+id/tv_vendedor_email"
                        android:layout_width="0dp"
                        android:layout_height="wrap_content"
                        android:layout_marginTop="4dp"
                        android:text="Correo: Cargando..."
                        android:textColor="?attr/colorOnSurface"
                        android:clickable="true"
                        android:autoLink="email"
                        app:layout_constraintStart_toStartOf="parent"
                        app:layout_constraintTop_toBottomOf="@+id/tv_detalle_vendedor" />

                    <!-- Teléfono del Vendedor -->
                    <TextView
                        android:id="@+id/tv_vendedor_telefono"
                        android:layout_width="0dp"
                        android:layout_height="wrap_content"
                        android:layout_marginTop="4dp"
                        android:text="Teléfono: Cargando..."
                        android:textColor="?attr/colorOnSurface"
                        android:clickable="true"
                        android:autoLink="phone"
                        app:layout_constraintStart_toStartOf="parent"
                        app:layout_constraintTop_toBottomOf="@+id/tv_vendedor_email" />

                    <!-- ** IMPORTANTE: Se ha quitado el MaterialButton de contacto de aquí ** -->

                </androidx.constraintlayout.widget.ConstraintLayout>
            </androidx.cardview.widget.CardView>

        </androidx.constraintlayout.widget.ConstraintLayout>
    </androidx.core.widget.NestedScrollView>

    <!-- ****************************************************** -->
    <!-- NUEVA SECCIÓN: Contenedor de Botones Flotantes (FABs) -->
    <!-- ****************************************************** -->
    <LinearLayout
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:layout_gravity="bottom|end"
        android:orientation="horizontal"
        android:padding="16dp"
        android:elevation="8dp">

        <!-- 1. NUEVO BOTÓN: CHAT (FAB) -->
        <com.google.android.material.button.MaterialButton
            android:id="@+id/fab_chat"
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:layout_marginEnd="8dp"
            android:text="@string/contactar_chat"
            app:icon="@drawable/ic_chat_24"
            style="@style/Widget.MaterialComponents.Button.OutlinedButton.Icon"
            app:cornerRadius="24dp"
            android:tooltipText="Iniciar Chat con el Vendedor"
            android:contentDescription="Iniciar Chat con el Vendedor" />

        <!-- 2. BOTÓN EXISTENTE: LLAMAR (FAB) -->
        <com.google.android.material.button.MaterialButton
            android:id="@+id/fab_contactar"
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:text="@string/contactar_llamar"
            app:icon="@drawable/ic_call_24"
            style="@style/Widget.MaterialComponents.Button.Icon"
            app:cornerRadius="24dp"
            android:tooltipText="Llamar al Vendedor"
            android:contentDescription="Llamar al Vendedor" />

    </LinearLayout>
    <!-- ****************************************************** -->

</androidx.coordinatorlayout.widget.CoordinatorLayout>